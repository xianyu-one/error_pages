# Custom Error Pages Service

è¿™æ˜¯ä¸€ä¸ªåŸºäº Golang ç¼–å†™çš„é«˜æ€§èƒ½ã€é«˜å¹¶å‘ HTTP é”™è¯¯é¡µé¢æœåŠ¡å™¨ã€‚ä¸“ä¸ºé…åˆ Caddy 2ã€Nginx ç­‰åå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œç”¨äºæä¾›ç¾è§‚ä¸”ç»Ÿä¸€çš„è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ˆå¦‚ 404, 500, 502 ç­‰ï¼‰ã€‚

## âœ¨ ç‰¹æ€§

- é«˜æ€§èƒ½ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨å°†å¸¸ç”¨çŠ¶æ€ç é¡µé¢é¢„æ¸²æŸ“è‡³å†…å­˜ï¼Œå“åº”è¯·æ±‚æ—¶é›¶å†…å­˜åˆ†é…ã€‚
- å•æ–‡ä»¶ï¼šHTML æ¨¡æ¿ç›´æ¥åµŒå…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— å¤–éƒ¨æ–‡ä»¶ä¾èµ–ã€‚
- è½»é‡çº§ï¼šåŸºäº scratch åŸºç¡€é•œåƒæ„å»ºï¼ŒDocker é•œåƒæå°ã€‚
- å¤šæ¶æ„ï¼šæ”¯æŒ linux/amd64 å’Œ linux/arm64ã€‚
- å¯é…ç½®ï¼šæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡ä¿®æ”¹ç›‘å¬ç«¯å£ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Docker è¿è¡Œ (æ¨è)

é»˜è®¤ç›‘å¬ 80 ç«¯å£ï¼š

```Bash
docker run -d \
  --name error-pages \
  -p 8080:80 \
  mrxianyu/error_pages:latest
```

Docker Compose
```YAML
services:
  error-pages:
    image: mrxianyu/error_pages:latest
    container_name: error-pages
    restart: always
    environment:
      - PORT=8080  # å¯é€‰ï¼šä¿®æ”¹å®¹å™¨å†…éƒ¨ç›‘å¬ç«¯å£
    ports:
      - "8080:8080"
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é»˜è®¤å€¼è¯´æ˜

- PORT:80 è®¾ç½®æœåŠ¡ç›‘å¬çš„ç«¯å£å·ã€‚é Root è¿è¡Œå»ºè®®è®¾ä¸º >1024ã€‚

## ğŸ”Œ Caddy 2 é›†æˆæŒ‡å—

è¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒç”¨æ³•ã€‚åœ¨ä½ çš„ Caddyfile ä¸­é…ç½® handle_errorsï¼Œå°†é”™è¯¯è¯·æ±‚æ‹¦æˆªå¹¶è½¬å‘ç»™æ­¤æœåŠ¡ã€‚æ³¨æ„ï¼šreplace_status æŒ‡ä»¤æ˜¯å…³é”®ï¼Œå®ƒç¡®ä¿æœ€ç»ˆè¿”å›ç»™æµè§ˆå™¨çš„çŠ¶æ€ç æ˜¯æ­£ç¡®çš„ï¼ˆä¾‹å¦‚ 404ï¼‰ï¼Œè€Œä¸æ˜¯ Go æœåŠ¡è¿”å›çš„ 200ã€‚

```
:80 {
    # ä½ çš„æ­£å¸¸ä¸šåŠ¡åä»£
    reverse_proxy /api/* localhost:9000
    file_server

    # --- é”™è¯¯é¡µé¢é›†æˆé…ç½® ---
    handle_errors {
        # 1. å°†è¯·æ±‚è·¯å¾„é‡å†™ä¸ºé”™è¯¯ç  (ä¾‹å¦‚ /404, /503)
        rewrite * /{err.status_code}
        
        # 2. è½¬å‘ç»™ error-pages æœåŠ¡
        # å‡è®¾ docker å®¹å™¨åä¸º error-pagesï¼Œç«¯å£ä¸º 80
        reverse_proxy http://error-pages:80 {
            header_up Host {host}
            
            # 3. å¼ºåˆ¶ä½¿ç”¨åŸå§‹é”™è¯¯ç è¦†ç›–åç«¯è¿”å›çš„ 200 OK
            replace_status {err.status_code}
        }
    }
}
```

## ğŸ› ï¸ æœ¬åœ°æ„å»º

å¦‚æœä½ éœ€è¦ä¿®æ”¹ä»£ç å¹¶è‡ªè¡Œæ„å»ºï¼š

```Bash
# ç¼–è¯‘
CGO_ENABLED=0 go build -ldflags="-s -w" -o error_pages .

# è¿è¡Œ
./error_pages
```